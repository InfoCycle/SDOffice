<!DOCTYPE html>
<html>
  <head>
    <title>任务计划编制</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" type="text/css" href="../../css/table.css" />
	<link rel="stylesheet" type="text/css" href="../../css/menu.css" />
	<link rel="stylesheet" type="text/css" href="../../css/inputtext.css" />
	<link rel="stylesheet" href="../../css/validationEngine.jquery.css" type="text/css"></link>
	<link rel="stylesheet" href="../../css/button.css" type="text/css"></link>

	<link rel="stylesheet" href="../../plugin/jBox/Skins2/Gray/jbox.css" type="text/css"></link>
	<link rel="stylesheet" href="../../plugin/jUI/themes/base/jquery.ui.all.css">
	<style type="text/css" media="screen">
			@import "../../plugin/jdTables/css/demo_page.css";
			@import "../../plugin/jdTables/css/demo_table.css";
			@import "http://www.datatables.net/media/css/site_jui.ccss";
			@import "../../plugin/jdTables/css/demo_table_jui.css";
			@import "../../plugin/jdTables/css/themes/base/jquery-ui.css";
			@import "../../plugin/jdTables/css/themes/smoothness/jquery-ui-1.7.2.custom.css";	
	</style>
	
	<script type="text/javascript" src="../../plugin/jdTables/js/complete.js"></script>	
	<script type="text/javascript" src="../../plugin/js/jquery.js"></script>
	<script src="../../plugin/jdTables/js/jquery.dataTables.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="../../plugin/jdTables/js/jquery.dataTables.editable.js"></script>
	<script src="../../plugin/jdTables/js/jquery.jeditable.js" type="text/javascript"></script>
    <script src="../../plugin/jdTables/js/jquery-ui.js" type="text/javascript"></script>
    <script src="../../plugin/jdTables/js/jquery.validate.js" type="text/javascript"></script>

	<script type="text/javascript" src="../../js/jquery.form.js"></script>
	<script type="text/javascript" src="../../plugin/js/jquery.validationEngine-zh.js"></script>
	<script type="text/javascript" src="../../plugin/js/jquery.validationEngine.js"></script>
	<script type="text/javascript" src="../../js/jQueryUtils.js"></script>
	<script type="text/javascript" src="../../js/publciUtil.js"></script>
	<script type="text/javascript" src="../../plugin/jBox/jquery.jBox-2.3.min.js"></script>
	<script type="text/javascript" src="../../plugin/jBox/jquery.jBox-zh-CN.js"></script>
	<script type="text/javascript"  src="../../plugin/jUI/ui/i18n/jquery.ui.datepicker-zh-CN.js"></script>		 
<style type="text/css">
body {
	background: #f5f5f5;
	height: 100%;
	width: 98%;
}
.demo-description {
	clear: both;
	padding: 12px;
	font-size: 1.3em;
	line-height: 1.4em;
}

.ui-draggable, .ui-droppable {
	background-position: top;
}
-->
</style>
<script type="text/javascript" language="javascript">
	if (window.navigator.userAgent.indexOf("Firefox") >= 1) {
		//如果浏览器为Firefox
		setActiveStyleSheet("papersother.css");
	} else {
		//如果浏览器为其它
		setActiveStyleSheet("papers.css");
	}
	function setActiveStyleSheet(filename) {
		document.write("<link href=\"..\/..\/css\/"+filename+"\" type=\"text\/css\" rel=\"stylesheet\">");
	}
</script>
  </head>  
  <body>  
   <form id="formplan" action="/Buss/PlanService/2" method="post">
		<div style="text-align:center">
			<table border="0" cellpadding="3" cellspacing="0"
				style="width:810px;margin:auto">
				<tr>
					<td><ul id="css3menu">
							<li class="topfirst"><a rel="#"><img
									src="../../images/menu/mainbkcm.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />
							</a>
							</li>
							<li><a rel="#" id="aT_OK"><img
									src="../../images/oa/ok.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />保存</a>
							</li>
							<li><a rel="#" id="aT_Post"><img
									src="../../images/oa/passfile.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />提交</a>
							</li>
							<li><a rel="#" id="aT_Cancel"><img
									src="../../images/oa/refresh.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />撤销</a>
							</li>
							<li><a rel="#" id="aT_CuiBan"><img
									src="../../images/oa/talk.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />催办</a>
							</li>
							<li><a rel='#'><img src="../../images/oa/quite.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />返回</a>
							</li>
							<li class="toplast"><a rel="#"><img
									src="../../images/menu/mainbkcm.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />
							</a>
						</ul> <br /> <br /></td>
				</tr>
				<tr>
					<td>
						<div class="content" id="content"
							style="height:659px;width:810px;display:table;text-align:left;">
							<div class="divimageclass"></div>
							<br />
							<br />
							<br />							 
							<div style="float:left;">
								<table class="content_table1" width="780px" border="1"
									cellpadding="0" style="position:absolute;">
									  <caption style="height:28px;font-size:18px;">
									    <strong>昆明松岛工程造价咨询有限公司  项目实施计划编制</strong>
									  </caption>
									  <tr>
									    <td width="89" >编号：</td>
									    <td width="330" ><label>
												<input type="hidden" id="FId" name="FId" style="width:20px;" />
												<input type="hidden" id="fkTaskId" name="fkTaskId" style="width:20px;" />
												<label id="TaskH">KMSD-计划-</label><input type="text"
												id="FPlanNumbers" name="FPlanNumbers" value=""
												style="width:201px;"
												class="validate[required,minSize[5],maxSize[50]]"><label
												id="TaskYear"></label> </label></td>
									    <td width="101" >服务类别</td>
									    <td scope="col"><lable id="Ffwlb"></lable></td>
									  </tr>
									  <tr>
									    <td width="89">任务名称</td>
									    <td width="330"><lable id="Frwmc"></lable></td>
									    <td width="101">项目经理</td>
									    <td><lable id="Fxmjl"></lable></td>
									  </tr>
									  <tr>
									    <td width="89">委托单位</td>
									    <td width="330"><lable id="Fwtdw"></lable></td>
									    <td width="101">&nbsp;</td>
									    <td>&nbsp;</td>
									  </tr>
									  <tr>
									    <td colspan="4" align="center"><strong>项&nbsp;&nbsp;目&nbsp;&nbsp;组&nbsp;&nbsp;人&nbsp;&nbsp;员&nbsp;&nbsp;安&nbsp;&nbsp;排</strong></td>									    
									  </tr>
									  <!--<tr>
									    <td width="89">姓名</td>
									    <td width="330">工作内容</td>
									    <td width="101">担任职务</td>
									    <td>联系电话</td>
									  </tr>-->
									  <tr>
									    <td colspan="4">
										<div>
											<table cellpadding="0" cellspacing="0" border="0" class="display" id="personTeam">		 
												<thead>
													<tr>
														<th width="10px">系统编号</th>
														<th width="10px">计划编号</th>
														<th width="10px">人员ID</th>
														<th width="63px">姓名</th>
														<th width="302px">工作内容</th>
														<th width="121px">担任职务</th>
														<th>联系电话</th>														
													</tr>
												</thead>
												<tbody>											
												</tbody>										
											</table>
										</div>
										</td>									    
									  </tr>									  
									  <tr>
									    <td colspan="4" align="center"><strong>时&nbsp;&nbsp;间&nbsp;&nbsp;安&nbsp;&nbsp;排</strong></td>									    
									  </tr>
									  <tr>
									    <td width="80">1</td>
									    <td width="330">收集资料（现场踏勘）时间</td>
									    <td colspan="2">&nbsp;<label> <input type="text"
												style="width:121px;cursor: pointer;" id="FCollectDataTime"
												name="FCollectDataTime"> </label></td>
									  </tr>
									  <tr>
									    <td width="80">2</td>
									    <td width="330">过程实施时间</td>
									    <td colspan="2">&nbsp;<label> <input type="text"
												style="width:121px;cursor: pointer;" id="FProcessImnTime"
												name="FProcessImnTime"> </label></td>
									  </tr>
									  <tr>
									    <td width="80">3</td>
									    <td width="330">提交复核时间</td>
									    <td colspan="2">&nbsp;<label> <input type="text"
												style="width:121px;cursor: pointer;" id="FSubmitRewTime"
												name="FSubmitRewTime"> </label></td>
									  </tr>
									  <tr>
									    <td width="80">4</td>
									    <td width="330">出具正式成果文件时间</td>
									    <td colspan="2">&nbsp;<label> <input type="text"
												style="width:121px;cursor: pointer;" id="FIssueResultsTime"
												name="FIssueResultsTime"> </label></td>
									  </tr>
									  <tr>
									    <td width="80">其它</td>
									    <td colspan="3">&nbsp;<label> <input type="text"
												style="width:90px;" id="FOther"
												name="FOther"> </label></td>
									  </tr>
									  <tr>
									    <td width="80">部门意见</td>
									    <td width="330">&nbsp;<label> <input type="text"
												style="width:90px;" id="FDeptOpinion"
												name="FDeptOpinion"> </label></td>
									    <td width="101">时间</td>
									    <td>&nbsp;<label> <input type="text"
												style="width:90px;" id="FDeptOpinionTime"
												name="FDeptOpinionTime"> </label></td>
									  </tr>
									</table>
								<br />
								<br />
								<input id="output2" type="hidden" value="" />
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td><ul id="css3menu">
							<li class="topfirst"><a rel="#"><img
									src="../../images/menu/mainbkcm.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />
							</a>
							</li>
							<li><a rel="#" id="aB_OK"><img
									src="../../images/oa/ok.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />保存</a>
							</li>
							<li><a rel="#" id="aB_Post"><img
									src="../../images/oa/passfile.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />提交</a>
							</li>
							<li><a rel="#" id="aB_Cancel"><img
									src="../../images/oa/refresh.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />撤销</a>
							</li>
							<li><a rel="#" id="aB_CuiBan"><img
									src="../../images/oa/talk.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />催办</a>
							</li>
							<li><a rel='workflow/process-list'><img
									src="../../images/oa/quite.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />返回</a>
							</li>
							<li class="toplast"><a rel="#"><img
									src="../../images/menu/mainbkcm.png"
									style="margin-right: 5px;padding-bottom: 0px; margin-bottom: 2px;" />
							</a>
						</ul> <br /> <br /></td>
				</tr>
			</table>
			<br/>			
		</div>
	</form>
	<form id="formAddNewRow" action="#" title="添加项目组成员" style="width:600px;min-width:600px">
        <label for="engine">姓名</label><br />
	<input type="text" name="engine" id="name" class="required" rel="0" />
        <br />
        <label for="browser">工作内容</label><br />
	<input type="text" name="browser" id="browser" rel="1" />
        <input type="hidden" name="platform" rel="2" />
        <br />
        <label for="version">Engine version</label><br />
	<select name="version" id="version" rel="3">
                <option>1.5</option>
                <option>1.7</option>
                <option>1.8</option>
        </select>
        <br />
        <label for="grade">CSS grade</label><br />
		<input type="radio" name="grade" value="A" rel="4"> First<br>
		<input type="radio" name="grade" value="B" rel="4"> Second<br>
		<input type="radio" name="grade" value="C" checked rel="4"> Third
        <br />
	</form>
	<script type="text/javascript" language="javascript">
		$(document).ready(function() {
			$("#formplan").validationEngine('attach');
				 $("#formplan").validationEngine({
				 ajaxFormValidation : true
			 });
			 var Key = $.request.queryString["Key"];
			 //alert(Key);
			 var TaskID = $.request.queryString["TaskID"];

			 $( "#FCollectDataTime" ).datepicker({
								showOn: "button",
								buttonImage: "/html/images/calendar.gif",
								buttonImageOnly: true,
								altFormat:'yy-mm-dd'

							});
							$( "#FProcessImnTime" ).datepicker({
								showOn: "button",
								buttonImage: "/html/images/calendar.gif",
								buttonImageOnly: true,
								altFormat:'yy-mm-dd'
							});

							$( "#FSubmitRewTime" ).datepicker({
								showOn: "button",
								buttonImage: "/html/images/calendar.gif",
								buttonImageOnly: true,
								altFormat:'yy-mm-dd'
							});
							$( "#FIssueResultsTime" ).datepicker({
								showOn: "button",
								buttonImage: "/html/images/calendar.gif",
								buttonImageOnly: true,
								altFormat:'yy-mm-dd'
							});
			 				 
			  var oTablePT = $('#personTeam').dataTable( {
					//"sScrollX": "769px",   //表格的宽度 
					"sScrollY": "151px",
					"bPaginate": true,
					"sScrollXInner": "101%",   //表格的内容宽度
					"bProcessing": false,
                    "bScrollCollapse": true,
					"bLengthChange": true,  //每页显示的记录数
				    "bFilter": true, //搜索栏
				    "bSort": true, //是否支持排序功能
				    "bInfo": true, //显示表格信息
				    "bAutoWidth": false,  //自适应宽度
					"sPaginationType": "full_numbers",//two_button or full_numbers
					"bStateSave": true, 
					"sAjaxSource": "/Buss/TaskPlanService/searchPlanPerson/"+$.request.queryString["ID"],
					"aoColumns": [
						{ "mData": "FId" },
						{ "mData": "fkImplementPlanId" },
						{ "mData": "FPersonnelId" },
						{ "mData": "FPersonnelName" },
						{ "mData": "FJobContent" },
						{ "mData": "FAsPosition" },
						{ "mData": "FContactPhone" }
					],
					"oLanguage": {
					  "sLengthMenu": "每页 _MENU_ 条",
					  "sZeroRecords": "对不起，查询不到任何相关数据",
					  "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
					  "sInfoEmtpy": "找不到相关数据",
					  "sInfoFiltered": "数据表中共为 _MAX_ 条记录)",
					  "sProcessing": "正在加载中...",
					  "sSearch": "搜索",
					  "sUrl": "", //多语言配置文件，可将oLanguage的设置放在一个txt文件中，例：Javascript/datatable/dtCH.txt
					  "oPaginate": {
						  "sFirst":    "第一页",
						  "sPrevious": " 上一页 ",
						  "sNext":     " 下一页 ",
						  "sLast":     " 最后一页 "
					  }
				  }, //多语言配置
				 "bJQueryUI": false,
				 "aLengthMenu": [[5,10, 25, 50, -1, 0], ["5","10", "25", "50", "ALL", "No View"]]  //设置每页显示记录的下拉菜单
			  }).makeEditable({
					 sUpdateURL: function(value, settings)
					 {return(value); },
                     sAddURL: "AddData.php",
                     sAddHttpMethod: "GET",
                     sDeleteHttpMethod: "GET",
					 sDeleteURL: "DeleteData.php",
                     "aoColumns": [
                    		 { 	cssclass: "required" },
                    		 {},
                    		 {
                				indicator: 'Saving platforms...',
                                tooltip: 'Click to edit platforms',
								type: 'textarea',
                                submit:'Save changes'
                    		 },
                    		 {
                                indicator: 'Saving Engine Version...',
                                tooltip: 'Click to select engine version',
                                loadtext: 'loading...',
                           		type: 'select',
                               	onblur: 'cancel',
								submit: 'Ok',
                                loadurl: 'EngineVersionList.php',
								loadtype: 'GET'
                    		 },
                    		{
                                indicator: 'Saving CSS Grade...',
                                tooltip: 'Click to select CSS Grade',
                                loadtext: 'loading...',
                           		type: 'select',
                               	onblur: 'submit',
                                data: "{'':'Please select...', 'A':'A','B':'B','C':'C'}"
                            }
							],
							oAddNewRowButtonOptions: {	label: "添加",
								icons: {primary:'ui-icon-plus'}
							},
							oDeleteRowButtonOptions: {	label: "删除", 
								icons: {primary:'ui-icon-trash'}
							},
							oAddNewRowFormOptions: { 	
                                 title: '添加项目组成员',
								 show: "blind",
								 hide: "explode",
                                 modal: true
							},
							sAddDeleteToolbarSelector: ".dataTables_length"	
				 });			     			     			     
			     oTablePT.fnSetColumnVis( 0,false );				 
			     oTablePT.fnSetColumnVis( 1,false );
			     oTablePT.fnSetColumnVis( 2, false );

				 if (Key == "New") {
					$.post("/Buss/TaskPlanService/3", {
						 "TaskID" : $.request.queryString["TaskID"]
					 }, function(data) {
						 $.post("/Buss/TaskPlanService/1",{"ID" : $.request.queryString["TaskID"]},function(data){
							//获得任务信息
							//设置表单值
							//$("#fkTaskId").attr("value",data.root[0].fkTaskId);
							alert("获得任务信息");
						 },"json");
						 SetFormValue(data, "New");
					 }, "json");
				 } else if (Key = "Edit") {
					 $.post("/Buss/TaskPlanService/2", {
						  "ID" : $.request.queryString["ID"]
				       }, function(data) {
							 if (data.success) {
								 SetFormValue(data, "Edit");
							 } else {
								 $.jBox.info('任务获取失败，请检查网络或联系系统管理员！');
								 return false;
							 }
					 }, "json");
				 } else if (Key = "View") {
					 SetFormValue(data, "View");
				 }			
			function SetFormValue(data, type) {
				$("#FId").attr("value", data.root[0].FId);
			    //设置表单值			    
				$("#fkTaskId").attr("value",data.root[0].fkTaskId);
				$("#FPlanNumbers").attr("value",data.root[0].FPlanNumbers);			
				$("#Ffwlb").text(data.root[0].FServiceCategoryName);
				$("#Frwmc").text(data.root[0].FTaskName);
				$("#Fxmjl").text(data.root[0].FProjMgrName);
				$("#Fwtdw").text(data.root[0].FEntrustUnitName);
			}
		});
	</script>
  </body>
</html>
