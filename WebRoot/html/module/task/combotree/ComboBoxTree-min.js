Ext.ux.ComboBoxTree=function(){this.treeId=Ext.id()+"-tree";this.maxHeight=arguments[0].maxHeight||arguments[0].height||this.maxHeight;this.tpl=new Ext.Template('<tpl for="."><div style="height:'+this.maxHeight+'px"><div id="'+this.treeId+'"></div></div></tpl>');this.store=new Ext.data.SimpleStore({fields:[],data:[[]]});this.selectedClass="";this.mode="local";this.triggerAction="all";this.onSelect=Ext.emptyFn;this.editable=false;this.beforeBlur=Ext.emptyFn;this.selectNodeModel=arguments[0].selectNodeModel||"exceptRoot";this.addEvents("afterchange");Ext.ux.ComboBoxTree.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.ComboBoxTree,Ext.form.ComboBox,{expand:function(){Ext.ux.ComboBoxTree.superclass.expand.call(this);if(this.tree.rendered){return}Ext.apply(this.tree,{height:this.maxHeight,width:(this.listWidth||this.width-(Ext.isIE?3:0))-2,border:false,autoScroll:true});if(this.tree.xtype){this.tree=Ext.ComponentMgr.create(this.tree,this.tree.xtype)}this.tree.render(this.treeId);var a=this.tree.getRootNode();if(!a.isLoaded()){a.reload()}this.tree.on("click",function(d){var c=this.selectNodeModel;var b=d.isLeaf();if((d==a)&&c!="all"){return}else{if(c=="folder"&&b){return}else{if(c=="leaf"&&!b){return}}}var e=this.getNode();if(this.fireEvent("beforeselect",this,d,e)!==false){this.setValue(d);this.collapse();this.fireEvent("select",this,d,e);(e!==d)?this.fireEvent("afterchange",this,d,e):""}},this)},setValue:function(a){this.node=a;var b=a.text;this.lastSelectionText=b;if(this.hiddenField){this.hiddenField.value=a.id}Ext.form.ComboBox.superclass.setValue.call(this,b);this.value=a.id},getValue:function(){return typeof this.value!="undefined"?this.value:""},getNode:function(){return this.node},clearValue:function(){Ext.ux.ComboBoxTree.superclass.clearValue.call(this);this.node=null},destroy:function(){Ext.ux.ComboBoxTree.superclass.destroy.call(this);Ext.destroy([this.node,this.tree]);delete this.node}});Ext.reg("combotree",Ext.ux.ComboBoxTree);